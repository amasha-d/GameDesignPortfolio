---
const projects = [
  { id: 1, title: "Hotel Espir", image: "../img/projects/Project1.png", description: `A fast-paced action game featuring feline chaos and explosive fun.`, behance: "https://www.behance.net/project1" },
  { id: 2, title: "Suit Up", image: "../img/projects/Project2.png", description: `Narrative horror experience using sound as the primary puzzle mechanic.`, behance: "https://www.behance.net/project2" },
  { id: 3, title: "Fiore: The Bloomskeeper", image: "../img/projects/Project4.png", description: `A comedic climbing game where childhood memories turn into ridiculous obstacles.`, behance: "https://www.behance.net/project3" },
  { id: 4, title: "Kid Stacking", image: "../img/projects/Project3.png", description: `A cozy forest-revival game about restoring an ecosystem.`, behance: "https://www.behance.net/project4" },
  { id: 5, title: "Forgotten Melodies", image: "../img/projects/Project1.png", description: `Stealth-based espionage game where communication is your greatest weapon.`, behance: "https://www.behance.net/project5" },
  { id: 6, title: "Chesship", image: "../img/projects/Project2.png", description: `Puzzle platformer where color transformation unlocks new pathways.`, behance: "https://www.behance.net/project6" },
  { id: 7, title: "Chaat Mania", image: "../img/projects/Project4.png", description: `Cozy cooking adventure set in a magical midnight cafe.`, behance: "https://www.behance.net/project7" },
  { id: 8, title: "Forest fires", image: "../img/projects/Project3.png", description: `Minimalist exploration game about discovering beauty in emptiness.`, behance: "https://www.behance.net/project8" },
  { id: 9, title: "Tree Quarters", image: "../img/projects/Project1.png", description: `Time-management puzzle where you construct increasingly complex machines.`, behance: "https://www.behance.net/project9" },
  { id: 10, title: "Itsy Bitsy Spider", image: "../img/projects/Project2.png", description: `Narrative-driven adventure about rekindling lost connections.`, behance: "https://www.behance.net/project10" },
  { id: 11, title: "Urban Quest", image: "../img/projects/Project4.png", description: `Synthwave racing game with dynamic soundtrack integration.`, behance: "https://www.behance.net/project11" },
  { id: 12, title: "Storyboard: Drowned Sorrow", image: "../img/projects/Project3.png", description: `Creative sandbox for building and exploring procedural worlds.`, behance: "https://www.behance.net/project12" },
 ];
---
 <!-- { id: 13, title: "Phantom Frames", image: "../img/projects/Project1.png", description: `Stop-motion inspired puzzle game about building animated scenes.`, behance: "https://www.behance.net/project13" },
  { id: 14, title: "Echo Legacy", image: "../img/projects/Project2.png", description: `Generational story game where choices ripple through time.`, behance: "https://www.behance.net/project14" }, -->

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Schoolbell&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" />
</head>

<body>
  <a href="../" class="back-btn" aria-label="Go back" onclick="if(history.length>1){event.preventDefault();history.back();}">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    Back
  </a>

  <main class="projects-shell">
    <section class="book-frame" id="bookFrame">
      <div id="projectsBook">
        {projects.map((project, idx) => (
          <article class="project-page" data-density={idx === 0 || idx === projects.length - 1 ? "hard" : "soft"}>
            <div class="page-inner">
              <h2 class="journal-title">{project.title}</h2>
              <div class="project-image">
                <img src={project.image} alt={`${project.title} preview`} />
              </div>
              <p class="journal-text">{project.description}</p>
              <a href={project.behance} target="_blank" rel="noopener noreferrer" class="know-more-btn">Know More -></a>
            </div>
          </article>
        ))}
      </div>
      <button id="prevPageBtn" class="edge-btn edge-btn-left" type="button" aria-label="Previous page">
        <img src="../img/obj/Next.png" alt="" class="edge-icon edge-icon-prev" />
      </button>
      <p class="page-chip"><span id="currentPage">1</span> / <span id="totalPages">{projects.length}</span></p>
      <button id="nextPageBtn" class="edge-btn edge-btn-right" type="button" aria-label="Next page">
        <img src="../img/obj/Next.png" alt="" class="edge-icon" />
      </button>
    </section>
  </main>

  <script is:inline src="https://unpkg.com/page-flip/dist/js/page-flip.browser.js"></script>
  <script define:vars={{ totalProjects: projects.length }}>
    const frame = document.getElementById("bookFrame");
    const bookElement = document.getElementById("projectsBook");
    const prevBtn = document.getElementById("prevPageBtn");
    const nextBtn = document.getElementById("nextPageBtn");
    const currentPageEl = document.getElementById("currentPage");
    const totalPagesEl = document.getElementById("totalPages");

    let pageFlip = null;
    let startX = 0;
    let startY = 0;
    let resizeTimer = null;
    let lastFlipAt = 0;

    function getPageFlipCtor() {
      if (window.St && window.St.PageFlip) return window.St.PageFlip;
      if (window.PageFlip) return window.PageFlip;
      return null;
    }

    function isMobileMode() {
      return window.matchMedia("(max-width: 768px), (hover: none) and (pointer: coarse)").matches;
    }

    function updateIndicator() {
      if (!pageFlip) return;
      const current = pageFlip.getCurrentPageIndex();
      const total = pageFlip.getPageCount();
      currentPageEl.textContent = String(current + 1);
      totalPagesEl.textContent = String(total);
      prevBtn.disabled = current <= 0;
      nextBtn.disabled = current >= total - 1;
    }

    function initBook() {
      const PageFlipCtor = getPageFlipCtor();
      if (!PageFlipCtor || !bookElement) return false;
      if (pageFlip) {
        updateIndicator();
        return true;
      }

      const mobile = isMobileMode();
      pageFlip = new PageFlipCtor(bookElement, {
        width: mobile ? 320 : 510,
        height: mobile ? 500 : 690,
        size: "stretch",
        minWidth: 280,
        maxWidth: 1100,
        minHeight: 430,
        maxHeight: 760,
        drawShadow: true,
        maxShadowOpacity: 0.5,
        showCover: true,
        usePortrait: true,
        flippingTime: 850,
        swipeDistance: 24,
        mobileScrollSupport: true,
      });

      pageFlip.loadFromHTML(document.querySelectorAll(".project-page"));
      pageFlip.on("flip", () => updateIndicator());
      updateIndicator();
      return true;
    }

    function waitAndInit() {
      let tries = 0;
      const timer = setInterval(() => {
        tries += 1;
        if (initBook() || tries > 80) clearInterval(timer);
      }, 50);
    }

    function flipByDelta(delta) {
      if (!pageFlip) return;
      const now = Date.now();
      if (now - lastFlipAt < 240) return;
      lastFlipAt = now;
      if (delta > 0) pageFlip.flipNext("top");
      if (delta < 0) pageFlip.flipPrev("top");
    }

    function handleWheelFlip(e) {
      e.preventDefault();
      const absX = Math.abs(e.deltaX);
      const absY = Math.abs(e.deltaY);
      const dominant = absX > absY ? e.deltaX : e.deltaY;
      if (Math.abs(dominant) < 6) return;
      flipByDelta(dominant);
    }

    window.addEventListener("wheel", handleWheelFlip, { passive: false });

    window.addEventListener("touchstart", (e) => {
      startX = e.changedTouches[0].clientX;
      startY = e.changedTouches[0].clientY;
    }, { passive: true });

    window.addEventListener("touchmove", (e) => {
      e.preventDefault();
    }, { passive: false });

    window.addEventListener("touchend", (e) => {
      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const deltaX = startX - endX;
      const deltaY = startY - endY;
      const dominant = Math.abs(deltaX) > Math.abs(deltaY) ? deltaX : deltaY;
      if (Math.abs(dominant) < 34) return;
      flipByDelta(dominant);
    }, { passive: true });

    prevBtn.addEventListener("click", () => {
      if (!pageFlip) return;
      pageFlip.flipPrev("top");
    });

    nextBtn.addEventListener("click", () => {
      if (!pageFlip) return;
      pageFlip.flipNext("top");
    });

    window.addEventListener("resize", () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => updateIndicator(), 180);
    });

    waitAndInit();
  </script>
</body>

<style>
  :global(html),
  :global(body) {
    margin: 0;
    height: 100%;
    min-height: 100vh;
    display: grid;
    place-items: center;
    overflow-x: hidden;
    overflow-y: hidden;
    overscroll-behavior: none;
    background: linear-gradient(180deg, #f7f2e7 0%, #efe5d2 100%);
    color: #2c2416;
    font-family: "Nunito", sans-serif;
  }

  .projects-shell {
    width: 100vw;
    height: 100dvh;
    display: grid;
    gap: 0;
    justify-items: center;
    align-items: center;
    padding: 0;
    overflow: visible;
  }

  .book-frame {
    position: relative;
    width: min(92vw, calc(100dvh * 1.6));
    height: 100dvh;
    max-height: 100dvh;
    background-image: url("../img/obj/Projectbook.png");
    background-size: auto 100%;
    background-position: center;
    background-repeat: no-repeat;
    padding: clamp(10px, 1.4vw, 18px);
    box-sizing: border-box;
    overflow: visible;
  }

  #projectsBook {
    width: 100%;
    height: 100%;
    max-width: 92%;
    max-height: 94%;
    margin: 0 auto;
    transform: translateY(clamp(14px, 2.4vh, 28px));
  }

  .project-page {
    background-color: #f7f1e4;
    background-image: linear-gradient(rgba(239, 241, 232, 0.5), rgba(227, 235, 160, 0.2)), url("../img/obj/bookBkg.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 12px;
    box-sizing: border-box;
    overflow: hidden;
    box-shadow: inset 0 0 0 1px rgba(78, 53, 29, 0.08);
  }

  .page-inner {
    /* height: 100%; */
    min-height: 0;
    padding: clamp(14px, 2vw, 24px);
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .journal-title {
    margin: 0;
    font-family: "Schoolbell", cursive;
    font-size: clamp(1.25rem, 2.2vw, 1.95rem);
    line-height: 1.2;
  }

  .project-image img {
    width: 100%;
    height: auto;
    max-height: 260px;
    object-fit: cover;
    display: block;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .journal-text {
    margin: 0;
    flex: 1 1 auto;
    min-height: 0;
    overflow: auto;
    padding-right: 4px;
    line-height: 1.65;
    font-size: clamp(0.95rem, 1.2vw, 1.08rem);
  }

  .know-more-btn {
    align-self: flex-start;
    margin-top: 0.25rem;
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    padding: 0.52rem 1rem;
    border-radius: 999px;
    text-decoration: none;
    color: #fff;
    background: #2c2416;
    font-weight: 700;
    font-size: 0.88rem;
  }

  .page-chip {
    position: absolute;
    left: 50%;
    bottom: 2.5%;
    transform: translateX(-50%);
    margin: 0;
    min-width: 84px;
    text-align: center;
    font-weight: 700;
    z-index: 15;
    background: rgba(255, 255, 255, 0.9);
    padding: 0.42rem 0.78rem;
    border-radius: 999px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  }

  .edge-btn {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 30;
    border: 0;
    background: transparent;
    padding: 0;
    cursor: pointer;
    width: 58px;
    height: 58px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .edge-btn-left {
    left: 16px;
  }

  .edge-btn-right {
    right: 16px;
  }

  .edge-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .edge-icon {
    width: 52px;
    height: 52px;
    object-fit: contain;
    display: block;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
  }

  .edge-icon-prev {
    transform: scaleX(-1);
  }

  .back-btn {
    position: fixed;
    left: 12px;
    top: 12px;
    z-index: 1200;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.92);
    color: #1a1a1a;
    border: 1px solid rgba(0, 0, 0, 0.1);
    padding: 8px 12px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 16px;
    font-family: "Schoolbell", cursive;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .stf__parent {
    position: relative;
    display: block;
    box-sizing: border-box;
    transform: translateZ(0);
    touch-action: pan-y;
  }

  .stf__block {
    position: absolute;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    perspective: 2000px;
  }

  .stf__item {
    display: none;
    position: absolute;
    transform-style: preserve-3d;
  }

  @media (max-width: 768px), (hover: none) and (pointer: coarse) {
    :global(body) {
      align-items: start;
      padding-top: 4rem;
      overflow: hidden;
    }

    .book-frame {
      width: min(96vw, calc(100svh * 1.6));
      height: 100svh;
      max-height: 100svh;
      background-image: url("../img/obj/Projectbooksmall.png");
      background-size: auto 100%;
      background-position: center;
      background-repeat: no-repeat;
      padding: 0.65rem;
    }

    #projectsBook {
      transform: translateY(clamp(8px, 1.6vh, 16px));
    }

    .page-chip {
      bottom: 1.2%;
      font-size: 0.9rem;
      padding: 0.35rem 0.65rem;
    }

    .edge-btn {
      width: 46px;
      height: 46px;
    }

    .edge-btn-left {
      left: 8px;
    }

    .edge-btn-right {
      right: 8px;
    }

    .edge-icon {
      width: 42px;
      height: 42px;
    }
  }
</style>

